<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Math AI - ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª</title>
<style>
body { font-family:sans-serif; padding:12px; background:#f8fafc; direction:rtl; }
#video { width:100%; max-width:640px; border-radius:8px; background:#000; }
#canvas { display:none; }
.btn { padding:10px 14px; border-radius:8px; background:#0b69ff; color:white; border:none; font-weight:600; }
.btn-secondary { background:#6b7280; }
.result { background:#fff; padding:10px; border-radius:8px; margin-top:12px; box-shadow:0 2px 6px rgba(0,0,0,0.08); }
label { display:block; margin-bottom:6px; font-weight:700; }
</style>
</head>
<body>
<h2>ðŸ“· Math AI - ØµÙˆÙ‘Ø± Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù„</h2>
<div>
<label>Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</label>
<video id="video" playsinline autoplay></video>
<canvas id="canvas"></canvas>
</div>
<div style="margin-top:8px;">
<button id="captureBtn" class="btn">Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©</button>
<button id="sendBtn" class="btn btn-secondary">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø­Ù„</button>
</div>
<div id="preview" style="margin-top:12px;"></div>
<div id="output" class="result" style="display:none;"></div>
<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const captureBtn = document.getElementById('captureBtn');
const sendBtn = document.getElementById('sendBtn');
const preview = document.getElementById('preview');
const output = document.getElementById('output');

let stream;
async function startCamera(){
  try { stream = await navigator.mediaDevices.getUserMedia({ video:{facingMode:"environment"}, audio:false }); video.srcObject = stream; }
  catch(e){ alert("ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: "+e.message);}
}
startCamera();

captureBtn.addEventListener('click', () => {
  const w = video.videoWidth;
  const h = video.videoHeight;
  canvas.width = w; canvas.height = h;
  const ctx = canvas.getContext('2d'); ctx.drawImage(video,0,0,w,h);
  const dataUrl = canvas.toDataURL('image/jpeg',0.9);
  preview.innerHTML = `<img src="${dataUrl}" style="width:100%; max-width:640px; border-radius:8px;" />`;
  output.style.display='none';
});

sendBtn.addEventListener('click', async () => {
  if(!canvas.width){ alert("Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø©"); return; }
  output.style.display='block'; output.innerText='â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
  canvas.toBlob(async (blob) => {
    const fd = new FormData(); fd.append('file', blob, 'capture.jpg');
    try {
      const res = await fetch('http://localhost:8000/solve-image', {method:'POST', body:fd});
      const data = await res.json();
      if(!data.ok){ output.innerHTML=`<b>Ø®Ø·Ø£:</b> ${data.message||JSON.stringify(data)}`; return;}
      const ex = data.extracted||''; const result = data.result||{};
      let html = `<h4>Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬:</h4><div>${ex.replace(/\n/g,'<br/>')}</div><hr/>`;
      if(result.error) html+=`<div><b>ØªØ¹Ø°Ø± Ø§Ù„Ø­Ù„:</b> ${result.error}</div>`;
      else if(result.type==='equation'){ html+=`<div><b>Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¨Ø³ÙŠØ·:</b> ${result.fixed}</div>`; html+=`<div><b>Ø§Ù„Ø­Ù„:</b> ${JSON.stringify(result.solution)}</div>`;}
      else if(result.type==='expression') html+=`<div><b>Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ¹Ø¨ÙŠØ±:</b> ${result.value}</div>`; 
      else if(result.type==='boolean') html+=`<div><b>ØªÙ‚ÙŠÙŠÙ…:</b> ${result.equal}</div>`;
      else html+=`<div>Ù†ØªÙŠØ¬Ø©: ${JSON.stringify(result)}</div>`; output.innerHTML=html;
    } catch(err){ output.innerHTML=`<b>Ø®Ø·Ø£ Ø¨Ø§Ù„Ø§ØªØµØ§Ù„:</b> ${err.message}`;}
  },'image/jpeg',0.9);
});
</script>
</body>
</html>
